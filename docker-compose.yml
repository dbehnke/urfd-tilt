services:
  urfd:
    image: urfd
    container_name: urfd
    command: urfd /usr/local/etc/urfd/urfd.ini
    network_mode: host  # Use host networking for direct AllStar communication
    volumes:
      - ./config/production:/usr/local/etc/urfd:ro
      - ./data/logs:/var/log/urfd
      - ./data/audio:/usr/local/bin/audio
    restart: unless-stopped

  tcd:
    image: tcd
    container_name: tcd
    command: tcd /usr/local/etc/tcd/tcd.ini
    network_mode: host  # Share host network with urfd
    depends_on:
      - urfd
    volumes:
      - ./config/production:/usr/local/etc/tcd:ro
    restart: unless-stopped

  dashboard:
    image: dashboard
    container_name: dashboard
    command: dashboard -config /etc/dashboard/config.yaml
    ports:
      - "8080:8080/tcp"    # Dashboard HTTP
    environment:
      - URFD_HOST=urfd
    extra_hosts:
      - "host.docker.internal:host-gateway"  # Allow dashboard to reach host urfd
    depends_on:
      - urfd
    volumes:
      - ./config/dashboard:/etc/dashboard:ro
      - ./data/audio:/usr/local/bin/audio:ro
      - ./data/dashboard:/app/data
    restart: unless-stopped
